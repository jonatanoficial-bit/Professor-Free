<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#ff7a00" />
  <title>Teacher Assist</title>

  <!-- CSS crítico: garante hidden mesmo se der problema -->
  <style>
    :root{color-scheme:dark}
    body{margin:0;background:#0b0b0e;color:#eaeaf0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .hidden{display:none!important}
  </style>

  <link rel="manifest" href="./manifest.webmanifest?v=21">
  <link rel="stylesheet" href="./styles.css?v=21">
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="dot"></div>
      <div>
        <div class="brand-title">Teacher Assist</div>
        <div class="brand-sub">Offline/Online • Preto & Laranja</div>
      </div>
    </div>
    <div class="topbar-actions">
      <button id="btnInstall" class="btn btn-ghost hidden">Instalar</button>
      <button id="btnExport" class="btn btn-ghost">Exportar</button>
      <label class="btn btn-ghost filebtn">
        Importar
        <input id="importFile" type="file" accept="application/json" />
      </label>
    </div>
  </header>

  <main class="container">
    <div id="toast" class="toast hidden"></div>

    <!-- Onboarding -->
    <section id="viewOnboarding" class="card hidden">
      <h1>Cadastro do Professor</h1>
      <p class="muted">Preencha uma vez. Depois você pode editar e exportar seus dados a qualquer momento.</p>

      <form id="formTeacher" class="grid">
        <div class="field">
          <label>Nome</label>
          <input required name="name" placeholder="Ex: Prof. João Silva" />
        </div>
        <div class="field">
          <label>E-mail</label>
          <input name="email" type="email" placeholder="ex: prof@email.com" />
        </div>
        <div class="field">
          <label>Telefone</label>
          <input name="phone" placeholder="(xx) xxxxx-xxxx" />
        </div>

        <div class="divider"></div>

        <div class="field">
          <label>Instituição / Escola principal</label>
          <input name="school" placeholder="Ex: Escola Municipal X" />
        </div>
        <div class="field">
          <label>Cidade (opcional)</label>
          <input name="city" placeholder="Ex: São Paulo" />
        </div>

        <button class="btn btn-primary" type="submit">Salvar e continuar</button>
      </form>
    </section>

    <!-- Dashboard -->
    <section id="viewDashboard" class="hidden">
      <section class="card">
        <div class="row">
          <div>
            <h1 id="helloTitle">Olá!</h1>
            <p class="muted" id="helloSub">Organize turmas, alunos e anotações com poucos toques.</p>
          </div>
          <button id="btnEditTeacher" class="btn btn-ghost">Editar cadastro</button>
        </div>

        <div class="quick-actions">
          <button id="goSchools" class="tile">
            <div class="tile-title">Escolas</div>
            <div class="tile-sub">Mais de um local</div>
          </button>
          <button id="goClasses" class="tile">
            <div class="tile-title">Turmas</div>
            <div class="tile-sub">Criar e gerenciar</div>
          </button>
          <button id="goStudents" class="tile">
            <div class="tile-title">Alunos</div>
            <div class="tile-sub">Cadastro rápido</div>
          </button>

          <button id="goAttendance" class="tile">
            <div class="tile-title">Chamada</div>
            <div class="tile-sub">Criar sessão e marcar presença</div>
          </button>
          <button id="goPlans" class="tile">
            <div class="tile-title">Planos de aula</div>
            <div class="tile-sub">Objetivos e atividades</div>
          </button>
          <button id="goReports" class="tile">
            <div class="tile-title">Relatórios</div>
            <div class="tile-sub">Por aluno: presença + notas</div>
          </button>

          <button id="goQuickNote" class="tile">
            <div class="tile-title">+ Nota rápida</div>
            <div class="tile-sub">Evolução • Necessidade • Repertório • Plano</div>
          </button>
          <button id="goAI" class="tile">
            <div class="tile-title">IA & Insights</div>
            <div class="tile-sub">Resumos e alertas</div>
          </button>
        </div>
      </section>

      <section class="card">
        <h2>Últimas notas</h2>
        <div id="latestNotes" class="list"></div>
      </section>
    </section>

    <!-- Escolas -->
    <section id="viewSchools" class="card hidden">
      <div class="row">
        <h1>Escolas</h1>
        <button class="btn btn-ghost" data-back>Voltar</button>
      </div>

      <form id="formSchool" class="grid compact">
        <div class="field">
          <label>Nome da escola</label>
          <input required name="name" placeholder="Ex: Escola Estadual Y" />
        </div>
        <div class="field">
          <label>Observação</label>
          <input name="notes" placeholder="Ex: turno manhã" />
        </div>
        <button class="btn btn-primary" type="submit">Adicionar</button>
      </form>

      <div class="divider"></div>
      <div id="schoolsList" class="list"></div>
    </section>

    <!-- Turmas -->
    <section id="viewClasses" class="card hidden">
      <div class="row">
        <h1>Turmas</h1>
        <button class="btn btn-ghost" data-back>Voltar</button>
      </div>

      <form id="formClass" class="grid compact">
        <div class="field">
          <label>Nome da turma</label>
          <input required name="name" placeholder="Ex: Violão Iniciante" />
        </div>
        <div class="field">
          <label>Escola</label>
          <select required name="schoolId" id="classSchoolSelect"></select>
        </div>
        <div class="field">
          <label>Dias/horário (opcional)</label>
          <input name="schedule" placeholder="Ex: Seg/Qua 14:00" />
        </div>
        <button class="btn btn-primary" type="submit">Adicionar</button>
      </form>

      <div class="divider"></div>
      <div id="classesList" class="list"></div>
    </section>

    <!-- Alunos -->
    <section id="viewStudents" class="card hidden">
      <div class="row">
        <h1>Alunos</h1>
        <button class="btn btn-ghost" data-back>Voltar</button>
      </div>

      <form id="formStudent" class="grid compact">
        <div class="field">
          <label>Nome do aluno</label>
          <input required name="name" placeholder="Ex: Maria Souza" />
        </div>
        <div class="field">
          <label>Turma</label>
          <select required name="classId" id="studentClassSelect"></select>
        </div>
        <div class="field">
          <label>Contato/responsável (opcional)</label>
          <input name="contact" placeholder="Ex: mãe: (xx)..." />
        </div>
        <button class="btn btn-primary" type="submit">Adicionar</button>
      </form>

      <div class="divider"></div>

      <div class="row">
        <div class="field" style="flex:1">
          <label>Buscar aluno</label>
          <input id="studentSearch" placeholder="Digite para filtrar..." />
        </div>
      </div>
      <div id="studentsList" class="list"></div>
    </section>

    <!-- Chamada -->
    <section id="viewAttendance" class="card hidden">
      <div class="row">
        <h1>Chamada</h1>
        <button class="btn btn-ghost" data-back>Voltar</button>
      </div>

      <div class="grid compact">
        <div class="field">
          <label>Turma</label>
          <select id="attClassSelect"></select>
        </div>
        <div class="field">
          <label>Data</label>
          <input id="attDate" type="date" />
        </div>

        <div class="row">
          <button id="btnCreateSession" class="btn btn-primary" type="button">Criar sessão do dia</button>
          <button id="btnOpenLastSession" class="btn btn-ghost" type="button">Abrir última sessão</button>
        </div>
      </div>

      <div class="divider"></div>

      <section id="attSessionBox" class="hidden">
        <div class="row">
          <h2 id="attSessionTitle">Sessão</h2>
          <button id="btnSaveSession" class="btn btn-primary" type="button">Salvar chamada</button>
        </div>

        <div class="row" style="margin-top:10px">
          <button id="btnAllPresent" class="btn btn-ghost" type="button">Marcar todos presentes</button>
          <button id="btnAllAbsent" class="btn btn-ghost" type="button">Marcar todos faltaram</button>
        </div>

        <div id="attList" class="list"></div>

        <div class="divider"></div>
        <h2>Histórico (últimas 10 sessões)</h2>
        <div id="attHistory" class="list"></div>
      </section>

      <section id="attEmptyHelp" class="muted">
        Selecione uma turma e crie uma sessão para marcar presença.
      </section>
    </section>

    <!-- Planos de aula -->
    <section id="viewPlans" class="card hidden">
      <div class="row">
        <h1>Planos de aula</h1>
        <button class="btn btn-ghost" data-back>Voltar</button>
      </div>

      <form id="formPlan" class="grid compact">
        <div class="field">
          <label>Turma</label>
          <select required id="planClassSelect" name="classId"></select>
        </div>
        <div class="field">
          <label>Data</label>
          <input required type="date" name="date" />
        </div>
        <div class="field">
          <label>Título</label>
          <input required name="title" placeholder="Ex: Ritmo básico + exercício 1" />
        </div>
        <div class="field">
          <label>Objetivos</label>
          <textarea name="objectives" rows="3" placeholder="Ex: consolidar batida..."></textarea>
        </div>
        <div class="field">
          <label>Atividades (passo a passo)</label>
          <textarea name="activities" rows="4" placeholder="Ex: aquecimento, prática guiada..."></textarea>
        </div>
        <div class="field">
          <label>Materiais / Repertório</label>
          <textarea name="materials" rows="3" placeholder="Ex: música X, metrônomo..."></textarea>
        </div>
        <div class="field">
          <label>Tarefa / Continuação (opcional)</label>
          <textarea name="homework" rows="2" placeholder="Ex: praticar 10min/dia..."></textarea>
        </div>

        <button class="btn btn-primary" type="submit">Salvar plano</button>
      </form>

      <div class="divider"></div>
      <h2>Planos recentes</h2>
      <div id="plansList" class="list"></div>
    </section>

    <!-- Relatórios -->
    <section id="viewReports" class="card hidden">
      <div class="row">
        <h1>Relatório por aluno</h1>
        <button class="btn btn-ghost" data-back>Voltar</button>
      </div>

      <div class="grid compact">
        <div class="field">
          <label>Turma</label>
          <select id="repClassSelect"></select>
        </div>
        <div class="field">
          <label>Aluno</label>
          <select id="repStudentSelect"></select>
        </div>

        <button id="btnGenerateReport" class="btn btn-primary" type="button">Gerar relatório</button>
      </div>

      <div class="divider"></div>
      <div id="reportOutput" class="ai-output"></div>
    </section>

    <!-- Nota rápida -->
    <section id="viewQuickNote" class="card hidden">
      <div class="row">
        <h1>Nota rápida (modo aula)</h1>
        <button class="btn btn-ghost" data-back>Voltar</button>
      </div>

      <div class="grid compact">
        <div class="field">
          <label>Turma</label>
          <select id="quickClassSelect"></select>
        </div>

        <div class="field">
          <label>Aluno (opcional)</label>
          <select id="quickStudentSelect">
            <option value="">— Nota geral da turma —</option>
          </select>
        </div>

        <div class="field">
          <label>Tipo</label>
          <div class="segmented" id="noteTypeSegment">
            <button type="button" data-type="evolution" class="seg active">Evolução</button>
            <button type="button" data-type="need" class="seg">Necessidade</button>
            <button type="button" data-type="repertoire" class="seg">Repertório</button>
            <button type="button" data-type="plan" class="seg">Plano</button>
          </div>
        </div>

        <div class="field">
          <label>Texto</label>
          <textarea id="quickText" rows="5" placeholder="Ex: Hoje melhorou..."></textarea>
        </div>

        <button id="btnSaveQuickNote" class="btn btn-primary" type="button">Salvar nota</button>
      </div>

      <div class="divider"></div>
      <h2>Notas recentes desta turma</h2>
      <div id="quickRecentNotes" class="list"></div>
    </section>

    <!-- IA -->
    <section id="viewAI" class="card hidden">
      <div class="row">
        <h1>IA & Insights (offline)</h1>
        <button class="btn btn-ghost" data-back>Voltar</button>
      </div>

      <p class="muted">IA local: resumo, alertas e projeções simples a partir das notas (sem internet).</p>

      <div class="grid compact">
        <div class="field">
          <label>Turma</label>
          <select id="aiClassSelect"></select>
        </div>
        <button id="btnRunAI" class="btn btn-primary" type="button">Gerar insights</button>
      </div>

      <div class="divider"></div>
      <div id="aiOutput" class="ai-output"></div>
    </section>

    <!-- Edit teacher -->
    <section id="viewTeacherEdit" class="card hidden">
      <div class="row">
        <h1>Editar cadastro</h1>
        <button class="btn btn-ghost" data-back>Voltar</button>
      </div>

      <form id="formTeacherEdit" class="grid">
        <div class="field">
          <label>Nome</label>
          <input required name="name" />
        </div>
        <div class="field">
          <label>E-mail</label>
          <input name="email" type="email" />
        </div>
        <div class="field">
          <label>Telefone</label>
          <input name="phone" />
        </div>
        <button class="btn btn-primary" type="submit">Salvar</button>
      </form>
    </section>

    <footer class="footer">
      <div class="muted">PWA • Offline-first • Preto/Laranja</div>
    </footer>
  </main>

  <script src="./app.bundle.js?v=21" defer></script>
</body>
</html>